<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>nostr + webtorrent (vanilla)</title>
  <link rel="stylesheet" href="/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/webtorrent@1.9.7/webtorrent.min.js" defer></script>
  <script src="/script.js" defer></script>
</head>
<body>
  <header class="wrap">
    <h1>nostr â†’ webtorrent</h1>
    <p class="sub">browse NIP-35 torrent events (kind 2003), then stream/download in-browser via WebTorrent. keep it legal.</p>
  </header>

  <main class="wrap">
    <section class="card">
      <h2>browse torrents on nostr (nip-35)</h2>

      <details open>
        <summary>relays</summary>
        <div class="tiny" style="margin:6px 0 10px">edit the list, one per line. only public relays are shown by default.</div>
        <textarea id="relayList" class="mono" rows="4"></textarea>
        <div class="tiny" style="margin-top:10px">
          search accepts <strong>keywords</strong> (e.g. <code>house of david</code>) or <strong>tags</strong> (e.g. <code>movie</code> or <code>movie,4k</code> or <code>#movie</code>).
        </div>
        <div class="row" style="margin-top:8px">
          <input id="tagInput" type="text" placeholder="keywords or tags (comma-separated for tags)" />
          <input id="limitInput" type="number" min="1" max="200" value="100" style="max-width:140px" />
          <button id="searchBtn" type="button">search</button>
        </div>
      </details>

      <div id="nostrStatus" class="tiny" style="margin-top:10px;color:#a7b0bb">status: idle</div>

      <div id="results" class="list"></div>
    </section>

    <section class="card">
      <h2>load a torrent manually</h2>

      <form id="magnet-form" class="row">
        <input id="magnet-input" type="text" inputmode="url" placeholder="paste magnet link here"
               autocomplete="off" spellcheck="false" />
        <button type="submit">load magnet</button>
      </form>

      <div class="or">or</div>

      <div id="drop" class="drop">
        <input id="file-input" type="file" accept=".torrent" />
        <label for="file-input" class="file-label">choose a .torrent file or drag it here</label>
      </div>

      <details class="tiny">
        <summary>advanced trackers (optional)</summary>
        <p>add extra webrtc trackers (comma-separated). note: webtorrent only works with <code>wss://</code> trackers.</p>
        <input id="trackers-input" type="text"
               placeholder="wss://tracker.openwebtorrent.com, wss://tracker.webtorrent.dev" />
      </details>
    </section>

    <section id="status" class="card hidden">
      <h2>status</h2>
      <div class="stat-grid">
        <div><span class="k">peers</span><span id="peerCount">0</span></div>
        <div><span class="k">downloaded</span><span id="downloaded">0 B</span></div>
        <div><span class="k">download rate</span><span id="downRate">0 B/s</span></div>
        <div><span class="k">upload rate</span><span id="upRate">0 B/s</span></div>
      </div>
      <progress id="progress" value="0" max="1"></progress>
      <div id="infohash" class="mono tiny"></div>
    </section>

    <section id="files" class="card hidden">
      <h2>files</h2>
      <ul id="fileList" class="file-list"></ul>
      <p id="save-tip" class="tiny">tip: right-click the download link if your browser auto-plays the file.</p>
    </section>

    <section id="preview" class="card hidden">
      <h2>preview</h2>
      <div id="viewer" class="viewer"></div>
    </section>
  </main>

  <footer class="wrap tiny">
    <p>nip-35 browsing uses websocket connections to relays; torrenting uses <a href="https://webtorrent.io/" target="_blank" rel="noopener noreferrer">webtorrent (webrtc)</a>.</p>
  </footer>
</body>
</html>